services:
    app:
        image: automaspec:latest
        build:
            context: .
            target: runner
        ports:
            - '${PORT:-3000}:${PORT:-3000}'
        environment:
            - PORT=${PORT:-3000}
        env_file:
            - .env
        volumes:
            - ./db:/app/db
        networks:
            - automaspec-network
        restart: unless-stopped
        healthcheck:
            test: ['CMD-SHELL', 'curl -f http://localhost:$$PORT/ || exit 1']
            interval: 30s
            timeout: 3s
            start_period: 40s
            retries: 3

networks:
    automaspec-network:
        driver: bridge
