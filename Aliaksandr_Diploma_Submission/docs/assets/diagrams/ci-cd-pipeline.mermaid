graph TD
    Start[Push to main / PR to dev/main] --> SecurityAudit[Security Audit Job]
    Start --> QualityChecks[Quality Checks Job]
    
    subgraph SecurityAudit["üîí Security Audit Job"]
        SA_Checkout[Checkout Repository]
        SA_Pnpm[Install pnpm]
        SA_Node[Setup Node.js 24]
        SA_Install[Install Dependencies<br/>pnpm ci]
        SA_Audit[Run Security Audit<br/>pnpm audit]
        
        SA_Checkout --> SA_Pnpm
        SA_Pnpm --> SA_Node
        SA_Node --> SA_Install
        SA_Install --> SA_Audit
    end
    
    subgraph QualityChecks["‚úÖ Quality Checks Job"]
        QC_Checkout[Checkout Repository]
        QC_Pnpm[Install pnpm]
        QC_Node[Setup Node.js 24]
        QC_Install[Install Dependencies<br/>pnpm ci]
        QC_Run[Run Quality Checks<br/>pnpm quality-checks]
        QC_Typecheck[TypeScript Type Check<br/>pnpm typecheck]
        QC_Tests[Unit Tests with Coverage<br/>pnpm test:coverage]
        QC_Lint[Lint Code<br/>pnpm lint]
        QC_Format[Format Code<br/>pnpm format]
        
        QC_Checkout --> QC_Pnpm
        QC_Pnpm --> QC_Node
        QC_Node --> QC_Install
        QC_Install --> QC_Run
        QC_Run --> QC_Typecheck
        QC_Run --> QC_Tests
        QC_Run --> QC_Lint
        QC_Run --> QC_Format
    end
    
    SecurityAudit --> E2ETests[E2E Tests Job]
    QualityChecks --> E2ETests
    
    subgraph E2ETests["üé≠ E2E Tests Job"]
        E2E_Checkout[Checkout Repository]
        E2E_Pnpm[Install pnpm]
        E2E_Node[Setup Node.js 24]
        E2E_Install[Install Dependencies<br/>pnpm ci]
        E2E_Setup[Setup Playwright<br/>pnpm test:setup-playwright]
        E2E_Run[Run E2E Tests<br/>pnpm test:e2e]
        
        E2E_Checkout --> E2E_Pnpm
        E2E_Pnpm --> E2E_Node
        E2E_Node --> E2E_Install
        E2E_Install --> E2E_Setup
        E2E_Setup --> E2E_Run
    end
    
    E2ETests --> DeployPreview[Deploy Preview Job]
    E2ETests --> DeployProduction[Deploy Production Job]
    
    subgraph DeployPreview["üöÄ Deploy Preview Job<br/>(PR to dev/main)"]
        DP_Checkout[Checkout Repository]
        DP_VercelCLI[Install Vercel CLI]
        DP_Pull[Pull Vercel Environment<br/>vercel pull --environment=preview]
        DP_Build[Build Project<br/>vercel build]
        DP_Deploy[Deploy Preview<br/>vercel deploy --prebuilt]
        
        DP_Checkout --> DP_VercelCLI
        DP_VercelCLI --> DP_Pull
        DP_Pull --> DP_Build
        DP_Build --> DP_Deploy
    end
    
    subgraph DeployProduction["üåê Deploy Production Job<br/>(Push to main)"]
        Prod_Checkout[Checkout Repository]
        Prod_VercelCLI[Install Vercel CLI]
        Prod_Pull[Pull Vercel Environment<br/>vercel pull --environment=production]
        Prod_Build[Build Project<br/>vercel build --prod]
        Prod_Deploy[Deploy Production<br/>vercel deploy --prebuilt --prod]
        
        Prod_Checkout --> Prod_VercelCLI
        Prod_VercelCLI --> Prod_Pull
        Prod_Pull --> Prod_Build
        Prod_Build --> Prod_Deploy
    end
    
    Start -.-> SecurityAudit
    Start -.-> QualityChecks
    
    style SecurityAudit fill:#fef3c7,stroke:#f59e0b
    style QualityChecks fill:#dbeafe,stroke:#3b82f6
    style E2ETests fill:#e0e7ff,stroke:#6366f1
    style DeployPreview fill:#d1fae5,stroke:#10b981
    style DeployProduction fill:#fce7f3,stroke:#ec4899
