graph TD
    Start[Push / PR] --> QC_Start
    Start --> E2E_Start
    
    subgraph "Quality Checks Job"
        QC_Start[Start] --> QC_Install[Install Dependencies]
        QC_Install --> QC_Audit[Security Audit (pnpm audit)]
        QC_Install --> QC_PrePush[Lefthook: Lint, Format, Typecheck, Unit Tests]
    end
    
    subgraph "E2E Tests Job"
        E2E_Start[Start] --> E2E_Install[Install Dependencies]
        E2E_Install --> E2E_Setup[Setup Playwright]
        E2E_Setup --> E2E_Run[Run Playwright Tests]
    end
    
    QC_PrePush --> Join{Build Success?}
    E2E_Run --> Join
    
    Join -- Yes --> Branch{Branch?}
    
    Branch -- "PR (dev/main)" --> Preview[Deploy Preview (Vercel)]
    Branch -- "push (main)" --> Prod[Deploy Production (Vercel)]
